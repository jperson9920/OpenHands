# docker-compose.yml
services:
  openhands:
    image: docker.all-hands.dev/all-hands-ai/openhands:latest
    user: "0:0"
    ports:
      - "3000:3000"
    volumes:
      # CRITICAL: Mount Docker socket (try each variant based on your system)
      # Standard Windows/Docker Desktop:
      - /var/run/docker.sock:/var/run/docker.sock
      # Mount workspace directory
      - ./workspace:/opt/workspace_base
      - ./.openhands-state:/root/.openhands-state
      # Ensure OpenHands file-store path is writable at container root
      - ./.openhands-state:/.openhands
      
    environment:
      # Docker/Runtime configuration
      - SANDBOX_RUNTIME_CONTAINER_IMAGE=docker.all-hands.dev/all-hands-ai/runtime:0.39-nikolaik
      - SANDBOX_USER_ID=1000
      - WORKSPACE_BASE=/opt/workspace_base
      - RUN_AS_OPENHANDS=true
      
      # NVIDIA NIM LLM Configuration
      - LLM_MODEL=openai/qwen2.5-coder-32b-instruct
      - LLM_BASE_URL=https://integrate.api.nvidia.com/v1
      - LLM_CUSTOM_LLM_PROVIDER=openai
      - LLM_TEMPERATURE=0.2
      
      # Optional: Additional LLM settings
      - LLM_TOP_P=0.95
      - LLM_MAX_OUTPUT_TOKENS=4096

  custom-dashboard:
    build:
      context: ./custom-dashboard
      dockerfile: Dockerfile
    container_name: openhands-dashboard
    restart: unless-stopped
    ports:
      - "8080:80"  # Custom dashboard web UI
    depends_on:
      - openhands
    networks:
      - openhands-network
    volumes:
      - ./custom-dashboard:/app
      - ./logs:/app/logs:ro
    environment:
      - OPENHANDS_API_URL=http://openhands:3000

networks:
  openhands-network:
    driver: bridge